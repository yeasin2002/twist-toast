# Configure npm Trusted Publisher (OIDC) + Freeze Vue Package

**Last updated:** February 27, 2026  
**Repo:** `twist-toast`  
**Workflow file used for publish:** `.github/workflows/release.yml`

---

## Why use npm Trusted Publisher (OIDC) instead of `NPM_TOKEN`?

Trusted publishing is better because:

1. No long-lived publish token stored in GitHub secrets.
2. Authentication is short-lived per workflow run (lower blast radius).
3. Binding is strict: npm trusts only a specific GitHub org/repo/workflow combination.
4. Better supply-chain security posture (works well with provenance).

In short: safer by default and less secret-management overhead.

---

## What you already have in this repo

You already have release automation at:

- `.github/workflows/release.yml`

And it already includes the critical OIDC permission:

- `permissions: id-token: write`

That means repository-side workflow setup is mostly ready.

---

## Step-by-step: Configure Trusted Publisher on npm

You must do this in npm UI for each package you want to publish.

### Step 1) Ensure package visibility/publishability is correct

For each package:

- `@twist-toast/react`: publishable (`private` not `true`, `publishConfig.access: public`)
- `@twist-toast/vue`: publishable for the initial seed release (`0.0.1`)
- `@twist-toast/core`: keep internal (`"private": true`)

### Step 2) Add trusted publisher for `@twist-toast/react`

1. Open npm package settings for `@twist-toast/react`.
2. Go to **Trusted Publisher**.
3. Choose **GitHub Actions**.
4. Enter:
   - Organization or user: `yeasin2002` (or your actual owner)
   - Repository: `twist-toast`
   - Workflow filename: `release.yml`
   - Environment name: leave empty unless you use GitHub environments
5. Save.

### Step 3) Add trusted publisher for `@twist-toast/vue`

Repeat the same configuration for `@twist-toast/vue`:

- same org/user
- same repo
- same workflow filename (`release.yml`)

Important:

- npm trusted publisher is configured per package.
- each package supports one trusted publisher configuration at a time.

### Step 4) Verify GitHub workflow permissions

In `.github/workflows/release.yml`, keep:

- `id-token: write`
- `contents: write`
- `pull-requests: write`

### Step 5) Run first release via Changesets

1. Push/merge to `main` with pending changesets.
2. Changesets Action opens/updates release PR.
3. Review and merge release PR.
4. Publish job runs and should publish:
   - `@twist-toast/react@0.1.0`
   - `@twist-toast/vue@0.0.1` (seed release)

---

## Temporary fallback while OIDC is not ready

Your workflow currently keeps `NPM_TOKEN` env fallback for migration safety.

Recommended sequence:

1. Configure trusted publisher first.
2. Confirm first OIDC-based publish succeeds.
3. Remove `NPM_TOKEN` / `NODE_AUTH_TOKEN` publish fallback from workflow.
4. Remove unused npm publish tokens from npm/GitHub secrets.

---

## How to freeze `@twist-toast/vue` after first publish

After `@twist-toast/vue@0.0.1` is published once, freeze it from regular releases.

### Step 1) Update Changesets config

Edit `.changeset/config.json`:

```json
{
  "ignore": ["@twist-toast/vue"]
}
```

If you already have other ignored packages, append Vue to the array.

### Step 2) Commit this as a policy change

Commit message example:

- `chore(release): freeze @twist-toast/vue from automated releases`

### Step 3) Keep React releases normal

Continue adding changesets for `@twist-toast/react` only.

### Step 4) Unfreeze Vue when real development starts

When ready:

1. remove `@twist-toast/vue` from `ignore`
2. add Vue changeset
3. release
4. optionally re-add to `ignore` if you want another pause

---

## How to verify everything worked

After first release:

1. Check npm:
   - `npm view @twist-toast/react version`
   - `npm view @twist-toast/vue version`
2. Check git tags in repo:
   - `@twist-toast/react@0.1.0`
   - `@twist-toast/vue@0.0.1`
3. Check GitHub Releases generated by Changesets Action.
4. Push a normal non-release change to `main` and confirm no new npm publish occurs.

---

## Common mistakes to avoid

1. Workflow filename mismatch in npm trusted publisher settings (must match exactly: `release.yml`).
2. Missing `id-token: write` in workflow permissions.
3. Forgetting to set package publishability (`private: true` blocks publish).
4. Freezing Vue before the seed publish happens.
5. Keeping old publish tokens longer than needed after OIDC is working.

---

## References

- npm trusted publishers: https://docs.npmjs.com/trusted-publishers
- npm provenance: https://docs.npmjs.com/generating-provenance-statements
- GitHub Actions OIDC concepts: https://docs.github.com/en/actions/concepts/security/openid-connect
- Changesets config (`ignore` behavior): https://github.com/changesets/changesets/blob/main/docs/config-file-options.md

